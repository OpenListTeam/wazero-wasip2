package local:test;

world test-world {
    // A record type with various fields.
    record my-data {
        a: u32,
        b: string,
        c: list<u8>,
    }

    // A function imported from the host.
    import host-log: func(msg: string);

    // Functions exported by the guest.
    export process-string: func(s: string);
    export roundtrip-string: func(s: string) -> string;
    export create-data: func() -> my-data;

    enum color {
        red,
        green,
        blue,
    }

    variant shape {
        circle(f32),
        rect(tuple<u32, u32>),
    }

    export handle-option: func(opt: option<string>) -> option<u32>;
    export handle-result: func(res: result<string, color>) -> result<u32, color>;
    export handle-variant: func(s: shape) -> string;


    flags permissions {
        read,
        write,
        execute,
    }

    // A new function to test flags.
    export handle-permissions: func(p: permissions) -> list<string>;

    // A new function to test a list of records.
    export process-users: func(users: list<my-data>) -> list<string>;

    record complex-record {
        id: string,
        permissions: option<permissions>,
        // A list of other records
        child-data: list<my-data>,
        shape-info: result<shape, string>,
    }

    export handle-complex-record: func(r: complex-record) -> u32;

    export handle-hetero-tuple: func(t: tuple<u32, u8, string>) -> string;

    export noop-complex: func(r: complex-record);

    record host-request {
      id: string,
      data: list<my-data>,
      config: option<permissions>,
    }

    // --- NEW: Import a complex function from the host ---
    import process-host-request: func(req: host-request) -> string;
    
    // --- NEW: Export a function that calls the complex import ---
    export call-complex-host-func: func(req: host-request) -> string;
}